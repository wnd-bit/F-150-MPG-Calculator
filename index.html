<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>F-150 MPG Estimator</title>

<style>
  body { background:#f4f6f9; margin:0; padding:20px; font-family:Arial,Helvetica,sans-serif; color:#222; }
  .mpg-widget {
    max-width:860px; margin:20px auto; background:#fff;
    border:1px solid #d9e2ec; border-radius:12px; padding:24px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
  }
  .mpg-widget h2 { margin:0 0 12px; font-size:22px; color:#0a2e6b; }
  .mpg-widget .intro { font-size:14px; color:#555; margin-bottom:20px; line-height:1.5; }

  .mpg-row { display:flex; gap:16px; flex-wrap:wrap; margin-bottom:14px; }
  .mpg-field { flex:1 1 240px; min-width:200px; }

  label { display:block; font-size:13px; color:#0a2e6b; margin-bottom:6px; font-weight:600; }
  input[type="number"], select {
    width:100%; padding:9px; border-radius:6px;
    border:1px solid #cfd8e3; font-size:14px; box-sizing:border-box;
  }
  .small { font-size:12px; color:#666; margin-top:4px; }

  .calc-grid { display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-bottom:14px; }
  @media(max-width:600px){ .calc-grid { grid-template-columns:1fr; } }

  .btn-row { display:flex; gap:10px; margin-top:16px; }
  button {
    padding:11px 18px; border:none; border-radius:6px;
    font-size:14px; cursor:pointer; font-weight:600;
    transition:all .25s ease;
  }
  button#calcBtn { background:#0a57a4; color:#fff; }
  button#calcBtn:hover { background:#084881; }
  button.secondary {
    background:#f4f6f8; color:#333; border:1px solid #d0d6dc;
  }
  button.secondary:hover { background:#e9edf1; }

  .result {
    margin-top:18px; padding:16px; border-radius:8px;
    background:#f9fbff; border:1px solid #dbe7ff;
  }
  .result strong { color:#0a2e6b; }
  .explain { font-size:13px; color:#444; margin-top:8px; line-height:1.5; }
  .footnote { font-size:12px; color:#777; margin-top:12px; }
</style>
</head>
<body>

<div class="mpg-widget" role="region" aria-label="F-150 MPG estimator">
  <h2>F-150 MPG Estimator — Local Conditions</h2>
  <div class="intro">Choose your engine preset, driving mix, and local factors like towing, wind, age, and weight. This tool adjusts the EPA MPG to reflect more realistic Oklahoma driving conditions.</div>

  <!-- Engine selection -->
  <div class="mpg-row">
    <div class="mpg-field">
      <label for="engine">Engine Preset</label>
      <select id="engine">
        <option value="powerboost">3.5L PowerBoost (Hybrid) — est. 22/24/23</option>
        <option value="2.7">2.7L EcoBoost — est. 19/25/21</option>
        <option value="3.5">3.5L EcoBoost — est. 17/25/20</option>
        <option value="5.0">5.0L V8 — est. 16/24/19</option>
        <option value="diesel">3.0L PowerStroke Diesel — est. 20/27/23</option>
        <option value="highout">3.5L High-Output (Raptor/Tremor) — est. 14/18/16</option>
        <option value="custom">Custom MPG</option>
      </select>
      <div class="small">Pick a common F-150 engine or select "Custom" to enter your own MPG.</div>
    </div>

    <div class="mpg-field" id="customMPGfield" style="display:none">
      <label for="customCity">Custom City MPG</label>
      <input id="customCity" type="number" min="1" step="0.1" value="20">
    </div>

    <div class="mpg-field" id="customHighwayField" style="display:none">
      <label for="customHwy">Custom Highway MPG</label>
      <input id="customHwy" type="number" min="1" step="0.1" value="25">
    </div>
  </div>

  <!-- Driving mix / Tank -->
  <div class="calc-grid">
    <div>
      <label for="mix">Driving Mix — % Highway</label>
      <input id="mix" type="number" min="0" max="100" step="1" value="60">
    </div>
    <div>
      <label for="tank">Fuel Tank Size (gallons)</label>
      <input id="tank" type="number" min="10" step="0.1" value="26">
    </div>
  </div>

  <!-- Load, incline -->
  <div class="mpg-row">
    <div class="mpg-field">
      <label for="towing">Towing / Load (%)</label>
      <input id="towing" type="number" min="0" max="200" step="1" value="0">
      <div class="small">0 = no tow; 50 = moderate towing; 100 = heavy load.</div>
    </div>
    <div class="mpg-field">
      <label for="incline">Average Incline (% grade)</label>
      <input id="incline" type="number" min="0" max="20" step="0.1" value="0">
    </div>
  </div>

  <!-- Wind, cargo -->
  <div class="mpg-row">
    <div class="mpg-field">
      <label for="wind">Wind Effect (%)</label>
      <input id="wind" type="number" min="-50" max="50" step="1" value="0">
      <div class="small">Negative = tailwind (better MPG), positive = headwind (worse MPG).</div>
    </div>
    <div class="mpg-field">
      <label for="extraWeight">Extra Cargo / Passengers (lbs)</label>
      <input id="extraWeight" type="number" min="0" step="10" value="0">
    </div>
  </div>

  <!-- Tires, speed -->
  <div class="mpg-row">
    <div class="mpg-field">
      <label for="tire">Tire / Drag Penalty (%)</label>
      <input id="tire" type="number" min="0" max="40" step="0.5" value="0">
    </div>
    <div class="mpg-field">
      <label for="speed">Average Highway Speed (mph)</label>
      <input id="speed" type="number" min="40" max="85" step="1" value="65">
    </div>
  </div>

  <!-- NEW: Truck Age / Maintenance -->
  <div class="mpg-row">
    <div class="mpg-field">
      <label for="age">Truck Age / Condition (years)</label>
      <input id="age" type="number" min="0" max="25" step="1" value="3">
      <div class="small">Older trucks with wear/maintenance gaps may lose MPG efficiency.</div>
    </div>
  </div>

  <!-- Buttons -->
  <div class="btn-row">
    <button id="calcBtn" type="button">Estimate MPG</button>
    <button class="secondary" id="resetBtn" type="button">Reset</button>
  </div>

  <!-- Results -->
  <div class="result" id="resultArea" aria-live="polite" style="display:none">
    <div><strong>Adjusted MPG:</strong> <span id="adjMPG">—</span> MPG (combined)</div>
    <div><strong>Miles per Tank:</strong> <span id="milesTank">—</span> miles</div>
    <div class="explain"><strong>How we adjusted it:</strong> <span id="breakdown">—</span></div>
    <div class="footnote">Note: This is an estimator for planning. Real-world MPG varies with driving style, vehicle age, condition, and environment.</div>
  </div>
</div>

<script>
(function(){
  const presets = {
    powerboost:{city:22, highway:24, combined:23},
    "2.7":{city:19, highway:25, combined:21},
    "3.5":{city:17, highway:25, combined:20},
    "5.0":{city:16, highway:24, combined:19},
    diesel:{city:20, highway:27, combined:23},
    highout:{city:14, highway:18, combined:16}
  };

  const $ = id => document.getElementById(id);
  const engineSel = $('engine');

  engineSel.addEventListener('change', () => {
    const v = engineSel.value;
    $('customMPGfield').style.display = v === 'custom' ? 'block' : 'none';
    $('customHighwayField').style.display = v === 'custom' ? 'block' : 'none';
  });

  function reset(){
    $('engine').value = 'powerboost';
    $('customCity').value = 20;
    $('customHwy').value = 25;
    $('mix').value = 60;
    $('tank').value = 26;
    $('towing').value = 0;
    $('incline').value = 0;
    $('wind').value = 0;
    $('extraWeight').value = 0;
    $('tire').value = 0;
    $('speed').value = 65;
    $('age').value = 3;
    $('resultArea').style.display = 'none';
  }

  $('resetBtn').addEventListener('click', reset);

  function estimate(){
    const preset = engineSel.value;
    let baseCity, baseHwy;
    if(preset==='custom'){
      baseCity = parseFloat($('customCity').value) || 18;
      baseHwy = parseFloat($('customHwy').value) || 24;
    } else {
      baseCity = presets[preset].city;
      baseHwy = presets[preset].highway;
    }

    const mix = clamp(parseFloat($('mix').value),0,100)/100;
    const tank = Math.max(1, parseFloat($('tank').value)||20);
    const towing = Math.max(0, parseFloat($('towing').value)||0);
    const incline = Math.max(0, parseFloat($('incline').value)||0);
    const wind = parseFloat($('wind').value)||0;
    const extraWeight = Math.max(0, parseFloat($('extraWeight').value)||0);
    const tire = Math.max(0, parseFloat($('tire').value)||0);
    const speed = Math.max(40, parseFloat($('speed').value)||65);
    const age = Math.max(0, parseFloat($('age').value)||0);

    const baseline = baseCity*(1-mix) + baseHwy*mix;

    // Penalties
    const towPenalty = 0.004 * towing;
    const inclinePenalty = 0.03 * incline;
    const windPenalty = 0.01 * wind;
    const weightPenalty = 0.005 * (extraWeight/100);
    const tirePenalty = 0.01 * tire;
    const speedPenalty = speed > 60 ? 0.005 * (speed - 60) : (speed < 55 ? -0.005 * (55 - speed) : 0);
    const agePenalty = 0.01 * age; // ~1% MPG loss per year

    let totalPenalty = towPenalty + inclinePenalty + windPenalty + weightPenalty + tirePenalty + speedPenalty + agePenalty;
    totalPenalty = clamp(totalPenalty, -0.15, 0.75);

    const adjustedMPG = Math.max(3, baseline / (1 + totalPenalty));
    const milesPerTank = Math.round(adjustedMPG * tank);

    const breakdown = [
      `Baseline MPG (weighted): ${round(baseline,2)} MPG`,
      `Towing penalty: ${(towPenalty*100).toFixed(1)}%`,
      `Incline penalty: ${(inclinePenalty*100).toFixed(1)}%`,
      `Wind penalty: ${(windPenalty*100).toFixed(1)}%`,
      `Extra-weight penalty: ${(weightPenalty*100).toFixed(2)}%`,
      `Tire/drag penalty: ${(tirePenalty*100).toFixed(1)}%`,
      `Speed penalty: ${(speedPenalty*100).toFixed(1)}%`,
      `Age/condition penalty: ${(agePenalty*100).toFixed(1)}%`,
      `Combined penalty factor: ${(totalPenalty*100).toFixed(1)}%`
    ].join('; ');

    $('adjMPG').textContent = round(adjustedMPG,2);
    $('milesTank').textContent = milesPerTank.toLocaleString();
    $('breakdown').textContent = breakdown;
    $('resultArea').style.display = 'block';
  }

  $('calcBtn').addEventListener('click', estimate);

  function clamp(v,min,max){ return Math.min(max,Math.max(min,v)); }
  function round(v,d){ const p=Math.pow(10,d||2); return Math.round(v*p)/p; }

  reset();
})();
</script>
</body>
</html>
